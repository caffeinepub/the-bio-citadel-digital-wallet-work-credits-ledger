{
  "kind": "build_request",
  "title": "Retry Internet Identity login fix with alternative authentication configuration approach",
  "projectName": "Bio Citadel Network",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-12",
      "text": "Remove any hardcoded Internet Identity provider URLs from useInternetIdentity.ts and rely exclusively on the @dfinity/auth-client default configuration to ensure proper Internet Identity service discovery for the production environment",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-yes"
        ],
        "quotes": [
          "Yes"
        ]
      },
      "acceptanceCriteria": [
        "The identityProvider parameter in AuthClient.create() is removed or set to undefined",
        "The auth-client library automatically discovers the correct Internet Identity service URL",
        "No references to 'id.ai' or custom identity provider URLs remain in the authentication flow"
      ]
    },
    {
      "id": "REQ-13",
      "text": "Verify and correct the derivationOrigin configuration in useInternetIdentity.ts to match the exact production frontend canister URL format required by Internet Identity",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-yes"
        ],
        "quotes": [
          "Yes"
        ]
      },
      "acceptanceCriteria": [
        "The derivationOrigin uses the correct format for Internet Computer frontend canisters",
        "The derivationOrigin matches the actual deployment URL where the application is hosted",
        "Authentication completes successfully without redirecting to incorrect domains"
      ]
    },
    {
      "id": "REQ-14",
      "text": "Add a pre-authentication validation check in the login flow that verifies the AuthClient configuration before initiating the login process and logs all configuration parameters including derivationOrigin, identityProvider, and maxTimeToLive",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-yes"
        ],
        "quotes": [
          "Yes"
        ]
      },
      "acceptanceCriteria": [
        "Configuration parameters are logged to console before login attempts",
        "Any misconfiguration is detected and reported with actionable error messages",
        "Users receive clear feedback if the authentication system is not properly configured"
      ]
    },
    {
      "id": "REQ-15",
      "text": "Implement an alternative authentication initialization approach that uses environment-specific configuration loading to ensure the correct Internet Identity settings are applied based on the deployment environment",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-yes"
        ],
        "quotes": [
          "Yes"
        ]
      },
      "acceptanceCriteria": [
        "Environment variables correctly distinguish between local development and production deployment",
        "Production builds use production-appropriate Internet Identity configuration",
        "Configuration loading is verified and logged during application initialization"
      ]
    }
  ],
  "constraints": [
    "Do not modify immutable frontend paths: frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, frontend/src/components/ui",
    "Maintain the existing single-actor backend architecture in backend/main.mo",
    "Preserve all existing error handling and logging mechanisms",
    "Do not change the backend canister ID configuration"
  ],
  "nonGoals": [
    "Implementing custom authentication providers other than Internet Identity",
    "Modifying the backend authentication or authorization logic",
    "Adding new authentication methods or social login options",
    "Changing the application's visual design or user interface layout"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}